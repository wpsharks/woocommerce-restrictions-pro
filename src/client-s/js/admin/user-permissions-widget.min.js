(function(a){a(document).ready(function(){var f="accrhcdehngpugpudhpcwtykbfdykarp";var e=window[f+"UserPermissionsWidgetData"];var h=neyjfbxruwddgfeedwacfbggzbxkwfxhJQueryJsGridData;var b=a("#"+f+"-user-permissions-widget");var l=b.find('.-grid[data-toggle~="jquery-jsgrid"]');if(!b.length||!l.length){return}var c=false;var d=a.parseJSON(b.find(".-user-permissions").val());var k=[{ID:0,title:""}];a.each(e.restrictionTitlesById,function(m,n){k.push({ID:m,title:n})});var j=[];a.each(e.userPermissionStatuses,function(m,n){j.push({status:m,title:n})});var i=function(m){return'<i class="si si-question-circle" data-toggle="jquery-ui-tooltip" title="'+_.escape(m)+'"></i>'};l.jsGrid(a.extend({},h.defaultOptions,{data:d,noDataContent:e.i18n.noDataContent,insertingByDefault:d.length===0,sorting:false,paging:false,onRefreshed:function(m){if(c){return}c=true;l.find(".jsgrid-grid-body > table > tbody").sortable({placeholder:"ui-state-highlight"})},onItemInserting:function(m){var n=parseInt(moment.utc().format("X"));if(m.item.status!=="expired"&&m.item.expire_time&&m.item.expire_time<=n){m.item.status="expired"}else{if(m.item.status==="expired"&&m.item.expire_time&&m.item.expire_time>n){m.item.status="enabled"}}},onItemUpdating:function(m){this.onItemInserting(m)},rowClass:function(m){if(m.is_trashed||m.status!=="enabled"){return"-is-not-allowed"}if(m.status==="expired"||(m.expire_time&&m.expire_time<=parseInt(moment.utc().format("X")))){return"-is-not-allowed"}if(m.access_time&&m.access_time>parseInt(moment.utc().format("X"))){return"-is-not-allowed"}return"-is-allowed"},rowClick:function(n){var m=a(n.event.target);if(m.is("a")){return}if(this._editingRow){this.updateItem()}this.editItem(m.closest("tr"))},fields:[{type:"number",align:"center",name:"ID",css:"-property-ID",title:e.i18n.idTitle,visible:false,},{type:"number",align:"center",name:"user_id",css:"-property-user-id",title:e.i18n.userIdTitle,visible:false,},{type:"number",align:"center",name:"order_id",css:"-property-order-id",title:e.i18n.orderIdTitle,visible:false,},{type:"number",align:"center",name:"subscription_id",css:"-property-subscription-id",title:e.i18n.subscriptionIdTitle,visible:false,},{type:"number",align:"center",name:"product_id",css:"-property-product-id",title:e.i18n.productIdTitle,visible:false,},{type:"number",align:"center",name:"item_id",css:"-property-item-id",title:e.i18n.itemIdTitle,visible:false,},{width:"30%",type:"select",align:"center",name:"restriction_id",css:"-property-restriction-id",title:e.i18n.restrictionIdTitle+" "+i(e.i18n.restrictionIdTitleTip),visible:true,editing:true,inserting:true,valueField:"ID",valueType:"number",textField:"title",items:k,validate:{validator:function(n,m){return typeof n==="number"&&n>0},message:function(n,m){return"• "+e.i18n.restrictionAccessRequired}},itemTemplate:function(n,m){var o="";if(!n||n==="0"){return""}o='<span class="-title">'+_.escape(e.restrictionTitlesById[n])+"</span>";if(m.order_id){if(e.current_user.can_edit_shop_orders){o+=' <span class="-via">'+_.escape(e.i18n.via+" "+e.i18n.orderIdTitle)+' <a href="'+_.escape(e["orderViewUrl="]+encodeURIComponent(m.order_id))+'">#'+_.escape(m.order_id)+"</a></span>"}else{o+=' <span class="-via">'+_.escape(e.i18n.via+" "+e.i18n.orderIdTitle)+" #"+_.escape(m.order_id)+"</span>"}}else{if(m.subscription_id){if(e.current_user.can_edit_shop_subscriptions){o+=' <span class="-via">'+_.escape(e.i18n.via+" "+e.i18n.subscriptionIdTitle)+' <a href="'+_.escape(e["subscriptionViewUrl="]+encodeURIComponent(m.subscription_id))+'">#'+_.escape(m.subscription_id)+"</a></span>"}else{o+=' <span class="-via">'+_.escape(e.i18n.via+" "+e.i18n.subscriptionIdTitle)+" #"+_.escape(m.subscription_id)+"</span>"}}}return o}},{width:"22.5%",type:"dateTime",align:"center",name:"access_time",css:"-property-access-time",title:e.i18n.accessTimeTitle+" "+i(e.i18n.accessTimeTitleTip),datePlaceholderText:e.i18n.accessDatePlaceholder,timePlaceholderText:e.i18n.accessTimePlaceholder,emptyDateTimeItemText:e.i18n.emptyAccessDateTime,noTimeEquals:"startOfDay",visible:true,editing:true,inserting:true,validate:{validator:function(n,m){return typeof n==="number"&&(!n||!m.expire_time||n<m.expire_time)},message:function(n,m){return"• "+e.i18n.accessTimeLtExpireTime}},},{width:"22.5%",type:"dateTime",align:"center",name:"expire_time",css:"-property-expire-time",title:e.i18n.expireTimeTitle+" "+i(e.i18n.expireTimeTitleTip),datePlaceholderText:e.i18n.expireDatePlaceholder,timePlaceholderText:e.i18n.expireTimePlaceholder,emptyDateTimeItemText:e.i18n.emptyExpireDateTime,noTimeEquals:"endOfDay",visible:true,editing:true,inserting:true,itemTemplate:function(n,m){if((m.order_id||m.subscription_id)&&m.expire_directive&&!parseInt(n)){if(typeof e.productPermissionExpireOffsetDirectives[m.expire_directive]==="string"){return _.escape(e.productPermissionExpireOffsetDirectives[m.expire_directive])}else{return _.escape(m.expire_directive)}}else{return this._timestampFormat(n,this.subType,true)}}},{type:"text",align:"center",name:"expire_directive",css:"-property-expire-directive",title:e.i18n.expireDirectiveTitle,visible:false,},{width:"15%",type:"select",align:"center",name:"status",css:"-property-status",title:e.i18n.statusTitle+" "+i(e.i18n.statusTitleTip),visible:true,editing:true,inserting:true,valueField:"status",valueType:"string",textField:"title",items:j,validate:{validator:function(n,m){return typeof n==="string"&&n&&n!=="0"},message:function(n,m){return"• "+e.i18n.restrictionStatusRequired}},itemTemplate:function(q,p){var r="";var o=true,n=false,m=false,s=false;if(!q||q==="0"){return""}if(p.is_trashed||p.status!=="enabled"){o=false,n=true}if(p.status==="expired"||(p.expire_time&&p.expire_time<=parseInt(moment.utc().format("X")))){o=false,n=true,s=true}if(p.access_time&&p.access_time>parseInt(moment.utc().format("X"))){o=false,m=true}if(!o){if(n){r+='<span class="si si-'+(s?"calendar-times-o":"eye-slash")+'" title="'+_.escape(e.i18n.statusIsDisabled+": "+e.userPermissionStatuses[p.status])+'" data-toggle="jquery-ui-tooltip"></span>'}else{if(m){r+='<span class="si si-calendar-check-o" title="'+_.escape(e.i18n.statusIsScheduled)+'" data-toggle="jquery-ui-tooltip"></span>'}}}r+=' <span class="-title">'+_.escape(e.userPermissionStatuses[p.status])+"</span>";return r}},{type:"number",align:"center",name:"is_trashed",css:"-property-is-trashed",title:e.i18n.isTrashedTitle,visible:false,},{type:"number",align:"center",name:"display_order",css:"-property-display-order",title:e.i18n.displayOrderTitle,visible:false,},{type:"number",align:"center",name:"insertion_time",css:"-property-insertion-time",title:e.i18n.insertionTimeTitle,visible:false,},{type:"number",align:"center",name:"last_update_time",css:"-property-last-update-time",title:e.i18n.lastUpdateTimeTitle,visible:false,},a.extend({},h.controlDefaultOptions)]}));l.find(".jsgrid-grid-header").tooltip({position:{my:"center bottom",at:"center top-10",using:function(m,n){a(this).css(m).addClass(n.vertical+" "+n.horizontal)}},content:function(){return a(this).prop("title")},tooltipClass:f+"-tooltip",items:'th [data-toggle~="jquery-ui-tooltip"]'});l.find(".jsgrid-grid-body").tooltip({position:{my:"right center",at:"left-10 center",using:function(m,n){a(this).css(m).addClass(n.vertical+" "+n.horizontal)}},content:function(){return a(this).prop("title")},tooltipClass:f+"-tooltip",items:'td [data-toggle~="jquery-ui-tooltip"]'});var g=function(o){var m=[];var n=l.find(".jsgrid-insert-mode-button.jsgrid-mode-on-button").length!==0;var q=l.find(".jsgrid-grid-header > table > tbody > tr.jsgrid-insert-row");var p=q.find("> td.-property-restriction-id select").val();if(n&&p&&p!=="0"){alert(e.i18n.notReadyToSave+"\n• "+e.i18n.stillInserting);o.preventDefault(),o.stopImmediatePropagation();return false}if(l.find(".jsgrid-grid-body > table > tbody > tr.jsgrid-edit-row").length){l.data("JSGrid").updateItem()}l.find(".jsgrid-grid-body > table > tbody > tr:not(.jsgrid-nodata-row)").each(function(r){m.push(a.extend(a(this).data("JSGridItem"),{display_order:r}))});b.find(".-user-permissions").val(JSON.stringify(m))};b.closest("form").on("submit",g)})})(jQuery);